<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients - Aleahim</title>
    <meta name="description" content="Elegant, Thread-Safe Authentication for OpenAPI Runtime">

    <meta property="og:url" content="https://aleahim.com/blog/token-middleware/">
    <meta property="og:title" content="Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients - Aleahim">
    <meta property="og:description" content="Elegant, Thread-Safe Authentication for OpenAPI Runtime">
    

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients - Aleahim">
    <meta name="twitter:description" content="Elegant, Thread-Safe Authentication for OpenAPI Runtime">
    

    <link rel="stylesheet" href="https://aleahim.com/css/theme.css">
    <link rel="stylesheet" href="https://aleahim.com/css/style.css">
    <link rel="stylesheet" href="https://aleahim.com/css/blog.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    

    <!-- Umami Analytics -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="1ee8d39f-4184-4d60-89a3-13131860112a"></script>
</head>

<body>
    <header>
        <div class="header-content">
            <a id="logo" href="https://aleahim.com">
                <img
                    src="https://aleahim.com/images/logo.svg"
                    alt="Aleahim"
                    title="Aleahim"
                >
                <h1 class="site-title">Aleahim.com</h1>
            </a>
    
            <nav>
                <div class="navigation">
                    <a href="https://aleahim.com/">Home</a>
                <a href="https://aleahim.com/cv/">CV</a>
                <a href="https://aleahim.com/services/">Services</a>
                <a href="https://aleahim.com/about/">About</a>
                </div>
            </nav>
        </div>
    </header>

    <main>
    <article class="blog-post">
        <header class="post-header">
            <div class="title-with-thumbnail">
                <div class="post-thumbnail">
                    <img src="https://aleahim.com/images/token/bearer_token1.jpg" alt="Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients">
                </div>
                <div class="title-wrapper">
                    <h1>Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients</h1>
                    <div class="post-meta">
                        <time datetime="2025-11-08T00:00:00.000Z">November 8, 2025</time>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="post-content">
            <div class="post-hero-image">
                <img src="https://aleahim.com/images/token/bearer_token1.jpg" alt="Building a Concurrency-Safe Bearer Token Middleware for Swift OpenAPI Clients">
            </div>
    
            <p>Authentication is one of those things that every API client needs, yet implementing it cleanly and safely can be surprisingly tricky—especially in Swift’s modern concurrency world. Today, I’m sharing a lightweight middleware solution that handles Bearer token authentication for OpenAPI-generated Swift clients in a thread-safe, composable way.</p><h2 id="the-problem">The Problem</h2><p>When working with OpenAPI Runtime in Swift, you often need to:</p><ul><li>Inject an <code>Authorization: Bearer &lt;token&gt;</code> header into API requests</li><li>Update tokens dynamically (after login, token refresh, etc.)</li><li>Skip authentication for certain endpoints (like login or public routes)</li><li>Ensure thread-safety in concurrent environments</li></ul><p>While this sounds straightforward, getting it right with Swift 6’s strict concurrency checking requires careful design. You need proper actor isolation, Sendable conformance, and a clean API that doesn’t fight the type system.</p><h2 id="the-solution-bearertokenauthenticationmiddleware">The Solution: BearerTokenAuthenticationMiddleware</h2><p>I built <code>BearerTokenAuthenticationMiddleware</code>—a minimal, zero-dependency package that solves these problems elegantly. Here’s what makes it special:</p><h3 id="1.-actor-isolated-token-storage">1. Actor-Isolated Token Storage</h3><p>The heart of the middleware is a private <code>TokenStorage</code> actor that manages the authentication token:</p><pre><code class="language-swift">private actor TokenStorage {
    var token: String?

    func getToken() -&gt; String? {
        token
    }

    func setToken(_ newToken: String?) {
        token = newToken
    }
}
</code></pre><p>This ensures that token reads and writes are <strong>never concurrent</strong>, eliminating race conditions completely.</p><h3 id="2.-clean-composable-api">2. Clean, Composable API</h3><p>Setting up the middleware is straightforward:</p><pre><code class="language-swift">import OpenAPIRuntime
import BearerTokenAuthMiddleware

let authMiddleware = BearerTokenAuthenticationMiddleware(
    initialToken: "my-secret-token"
)

let client = Client(
    serverURL: URL(string: "https://api.example.com")!,
    transport: AsyncHTTPClientTransport(),
    middlewares: [authMiddleware]
)
</code></pre><p>Every request now automatically includes <code>Authorization: Bearer my-secret-token</code>.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Building authentication middleware might seem like boilerplate, but doing it right—especially with modern Swift concurrency—requires thoughtful design. <code>BearerTokenAuthenticationMiddleware</code> provides:</p><ul><li>Thread-safe token management via actors</li><li>Selective authentication with operation-level control</li><li>Dynamic token updates</li><li>Zero dependencies</li><li>Clean composition with other middlewares</li></ul><p><strong>Repository</strong>: <a href="https://github.com/mihaelamj/BearerTokenAuthMiddleware" target="_blank">github.com/mihaelamj/BearerTokenAuthMiddleware</a></p>
        </div>
    
        <footer class="post-footer">
            <a href="https://aleahim.com/blog/" class="back-link">← Back to Blog</a>
        </footer>
    </article>

    </main>

    <footer>
        <p>This site was generated using <a href="https://www.swift.org/" target="_blank">Swift</a> & <a href="https://github.com/toucansites/toucan" target="_blank">Toucan</a>.</p>
    
        <p class="small">Aleahim &copy; 2025.</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    
</body>
</html>
